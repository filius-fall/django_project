<!-- chat/templates/chat/index.html -->
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Chat Rooms</title>
    </head>
    <body>
        What chat room would you like to enter?<br>
        <input id="room-name-input" type="text" size="100"><br>
        <input id="room-name-submit" type="button" value="Enter">

        <form action="" id="dj_form" method="post">
            {% csrf_token %}
            {{ form }}
            <!-- <input type="text" name="amount" id="amount">
            <input type="date" name="date" id="date">
            <input type="text" name="description" id="description">
            <input type="text" name="category" id="category"> -->
            <input type="submit" value="Submit">
        </form>





    <script>
        // document.querySelector('#room-name-input').focus();
        // document.querySelector('#room-name-input').onkeyup = function(e) {
        // if (e.keyCode === 13) { // enter, return
        // document.querySelector('#room-name-submit').click();
        // }
        // };
        // document.querySelector('#room-name-submit').onclick = function(e) {
        // var roomName = document.querySelector('#room-name-input').value;
        // window.location.pathname = '/chat/' + roomName + '/';
        // };









        const chatSocket = new WebSocket(
            'ws://'+window.location.host+'/ws/chat/socket-server','echo-protocol'
        )
        

        // chatSocket.onmessage = function(e){
        //     const data = JSON.parse(e.data)
        //     document.querySelector('#chat-log').value += (data.message + '\n')
        // }
        chatSocket.onclose = function(e){
            console.log(e)
            console.error('chat room closed unexpectedly')
        }
        var form_data_raw = document.getElementById('dj_form');
        function send_message(){
            
            var form_data = new FormData(form_data_raw);
            var a = []
            for(const [key, value] of form_data.entries()) {
                console.log(key, value);
                if(key != 'csrfmiddlewaretoken'){
                    a.push(value);
                }
            }
            chatSocket.send(JSON.stringify({
                'message':a
            }))
            console.log('MESSAGE SENT SUCCESFULLy')
        }
        form_data_raw.addEventListener('submit', function(e){
            e.preventDefault();
            send_message();
        })

        // document.querySelector('#chat-message-input').focus()
        // document.querySelector('#chat-message-input').onkeyup = function(e){
        //     if(e.keycode === 13){
        //         document.querySelector('#chat-message-submit').click()
        //     }
        // }
        // document.querySelector('#chat-message-submit').onclick = function(e){
        //     const messageV = document.querySelector('#chat-message-input')
        //     const v = messageV.value
        //     console.log(v)
        //     chatSocket.send(JSON.stringify({
        //         'message':v
        //     }))
        //     messageV.value = ''
        // }
    </script>
    </body>
</html>